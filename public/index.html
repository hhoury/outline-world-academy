<!DOCTYPE html>
<html lang="en" translate="no">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
    integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.webui-popover/1.2.1/jquery.webui-popover.min.css">

  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />

  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100&display=swap"
    rel="stylesheet" />
  <title>Outline World Academy</title>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <script type="text/javascript">
    var DotNetSample = {
      operation: function () {
        return "PAY";
      },
      endpoint: function () {
        return "http://localhost:5000/processHostedSession";
      },
      secureIdResponseUrl: function () {
        return null;
      }
    };
  </script>
  <div id="overlays"></div>
  <div id="root"></div>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
    integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous">
  </script>
  <script src="https://test-bobsal.gateway.mastercard.com/form/version/45/merchant/OUTWORLD/session.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.webui-popover/1.2.1/jquery.webui-popover.min.js"></script>
  <script src="https://www.google.com/recaptcha/api.js"></script>
  <script type="text/javascript">
    if (self === top) {
      var antiClickjack = document.getElementById("antiClickjack");
      if (antiClickjack) antiClickjack.parentNode.removeChild(antiClickjack);
    } else {
      top.location = self.location;
    }

    PaymentSession.setFocus('card.number');

    PaymentSession.setFocusStyle(["card.number", "card.securityCode"], {
      borderColor: 'red',
      borderWidth: '3px'
    });

    PaymentSession.configure({
      fields: {
        // ATTACH HOSTED FIELDS TO YOUR PAYMENT PAGE FOR A CREDIT CARD
        card: {
          name: "#cardHolder",
          number: "#cardNumber",
          securityCode: "#cvc",
          expiryMonth: "#expiry-month",
          expiryYear: "#expiry-year"
        }
      },
      //SPECIFY YOUR MITIGATION OPTION HERE
      frameEmbeddingMitigation: ["javascript"],
      callbacks: {
        initialized: function (response) {
          // HANDLE INITIALIZATION RESPONSE
          console.log('initialized response');
          console.log(response);
        },
        formSessionUpdate: function (response) {
          // HANDLE RESPONSE FOR UPDATE SESSION
          console.log('formSessionUpdate response');
          console.log(response);
          if (response.status) {
            if ("ok" == response.status) {
              //here you should call antoher api to save session id etc...
              console.log("Session updated with data: " + response.session.id);

              // Submit fields
              var data = {
                apiOperation: DotNetSample.operation(),
                sessionId: response.session.id,
                transactionId: $('#transaction-id').val(),
                orderId: $('#order-id').val(),
                orderAmount: $('#order-amount').val(),
                orderCurrency: $('#order-currency').val(),
                orderDescription: $('#order-description').val(),
                secureIdResponseUrl: DotNetSample.secureIdResponseUrl()
              };

              var xhr = new XMLHttpRequest();
              xhr.open('POST', DotNetSample.endpoint(), true);
              xhr.setRequestHeader('Content-Type', 'application/json');
              xhr.onreadystatechange = function () {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                  document.documentElement.innerHTML = this.response;
                }
              };
              xhr.send(JSON.stringify(data));

            } else if ("fields_in_error" == response.status) {

              console.log("Session update failed with field errors.");

              if (response.errors.cardNumber) {
                handleError("Card number missing or invalid.");
              }
              if (response.errors.expiryYear) {
                handleError("Expiry year missing or invalid.");
              }
              if (response.errors.expiryMonth) {
                handleError("Expiry month missing or invalid.");
              }
              if (response.errors.securityCode) {
                handleError("Security code invalid.");
              }
            } else if ("request_timeout" == response.status) {
              handleError("Session update failed with request timeout: " + response.errors.message);
            } else if ("system_error" == response.status) {
              handleError("Session update failed with system error: " + response.errors.message)
            }
          } else {
            handleError("Session update failed: " + response);
          }
        }
      }
    });

    function pay() {
      console.log('pay function');
      PaymentSession.updateSessionFromForm('card');
    }

  
  </script>
</body>

</html>